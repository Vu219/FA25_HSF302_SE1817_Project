<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin - Schedule Management</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/admin-style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="admin-page">

<!-- Main Content -->
<main class="admin-container">
    <!-- Alerts -->
    <div th:if="${param.success}" class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <div>
            <p th:if="${param.success == 'scheduleCreated'}">Schedule created successfully!</p>
            <p th:if="${param.success == 'scheduleUpdated'}">Schedule updated successfully!</p>
            <p th:if="${param.success == 'scheduleDeleted'}">Schedule deleted successfully!</p>
        </div>
    </div>

    <div th:if="${param.error}" class="alert alert-danger">
        <i class="fas fa-exclamation-triangle"></i>
        <div>
            <p th:if="${param.error == 'unauthorized'}">You are not authorized to access this page!</p>
            <p th:if="${param.error == 'scheduleNotFound'}">Schedule not found!</p>
            <p th:if="${param.error == 'deleteFailed'}">Failed to delete schedule. It may be linked to bookings.</p>
            <p th:unless="${param.error == 'unauthorized' or param.error == 'scheduleNotFound' or param.error == 'deleteFailed'}"
               th:text="${param.error}">Error occurred!</p>
        </div>
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
        <h2><i class="fas fa-calendar-alt"></i> Quản lý lịch trình</h2>
        <a th:href="@{/admin/schedules/new}" class="btn btn-primary">
            <i class="fas fa-plus-circle"></i> Thêm lịch trình mới
        </a>
    </div>

    <!-- Table -->
    <div class="table-container">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th><i class="fas fa-train"></i> Xe lửa</th>
                        <th><i class="fas fa-map-marker-alt"></i> Tuyến đường</th>
                        <th><i class="fas fa-calendar"></i> Khởi hành</th>
                        <th><i class="fas fa-calendar-check"></i> Đến</th>
                        <th><i class="fas fa-road"></i> Khoảng cách</th>
                        <th><i class="fas fa-pause-circle"></i> Thời gian dừng</th>
                        <th><i class="fas fa-dollar-sign"></i> Giá</th>
                        <th><i class="fas fa-cog"></i> Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="schedule : ${schedules}">
                        <td data-label="ID">
                            <strong>#<span th:text="${schedule.scheduleID}"></span></strong>
                        </td>
                        <td data-label="Train">
                            <i class="fas fa-train" style="color: var(--admin-secondary);"></i>
                            <span th:text="${schedule.train != null ? schedule.train.trainName : 'Chưa có tàu'}"></span>
                        </td>
                        <td data-label="Route">
                            <div style="display: flex; flex-direction: column; gap: 5px;">
                                <span>
                                    <i class="fas fa-circle" style="color: #28a745; font-size: 0.6em;"></i>
                                    <strong th:text="${schedule.departureStation.name}"></strong>
                                </span>
                                <span style="color: #6c757d; font-size: 0.9em;">
                                    <i class="fas fa-arrow-down"></i>
                                </span>
                                <span>
                                    <i class="fas fa-circle" style="color: #dc3545; font-size: 0.6em;"></i>
                                    <strong th:text="${schedule.arrivalStation.name}"></strong>
                                </span>
                            </div>
                        </td>
                        <td data-label="Departure">
                            <i class="fas fa-calendar-day" style="color: #28a745;"></i>
                            <span th:text="${#temporals.format(schedule.departureTime, 'dd/MM/yyyy')}"></span>
                            <br>
                            <i class="fas fa-clock" style="color: #17a2b8;"></i>
                            <span th:text="${#temporals.format(schedule.departureTime, 'HH:mm')}"></span>
                        </td>
                        <td data-label="Arrival">
                            <i class="fas fa-calendar-day" style="color: #dc3545;"></i>
                            <span th:text="${#temporals.format(schedule.arrivalTime, 'dd/MM/yyyy')}"></span>
                            <br>
                            <i class="fas fa-clock" style="color: #17a2b8;"></i>
                            <span th:text="${#temporals.format(schedule.arrivalTime, 'HH:mm')}"></span>
                        </td>
                        <td data-label="Distance">
                            <i class="fas fa-road"></i>
                            <span th:text="${schedule.distanceKm} + ' km'"></span>
                        </td>
                        <td data-label="Stop Duration">
                            <i class="fas fa-pause-circle"></i>
                            <span th:if="${schedule.stopDuration != null}" th:text="${schedule.stopDuration} + ' phút'"></span>
                            <span th:if="${schedule.stopDuration == null}" style="color: #6c757d;">-</span>
                        </td>
                        <td data-label="Price">
                            <strong style="color: var(--admin-success);">
                                <span th:text="${#numbers.formatDecimal(schedule.basePrice, 0, 'COMMA', 0, 'POINT')}"></span> VNĐ
                            </strong>
                        </td>
                        <td data-label="Actions">
                            <div class="action-buttons">
                                <a th:href="@{/admin/schedules/{id}/edit(id=${schedule.scheduleID})}"
                                   class="btn btn-info btn-sm">
                                    <i class="fas fa-edit"></i> Sửa
                                </a>
                                <a th:href="@{'/admin/schedules/delete/' + ${schedule.scheduleID}}" class="btn btn-danger btn-sm"
                                   onclick="return confirm('Bạn có chắc chắn muốn xóa lịch trin tàu này không?');"><i class="fas fa-trash"></i> Xóa</a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Empty State -->
            <div th:if="${#lists.isEmpty(schedules)}" class="empty-state">
                <i class="fas fa-calendar-times"></i>
                <h3>No Schedules Found</h3>
                <p>Click "Add New Schedule" button to create your first schedule.</p>
            </div>
        </div>
    </div>

</main>
</body>
</html>