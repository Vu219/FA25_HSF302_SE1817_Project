<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Trang chủ - Đặt vé tàu</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<header>
    <nav class="navbar container">
        <a th:href="@{/home}" class="logo">
            <i class="fas fa-train"></i> EVTrainTicket
        </a>
        <div class="nav-links" th:if="${session.user == null}">
            <a th:href="@{/login}">Đăng nhập</a>
            <a th:href="@{/register}">Đăng ký</a>
        </div>

        <div class="user-info" th:if="${session.user != null}">
            <p>Xin chào, <strong th:text="${session.user.fullName}"></strong>!</p>

            <a th:href="@{/booking/history}" class="admin-nav-link" style="background-color: #28a745; border-color: #28a745;">
                <i class="fas fa-history"></i> Vé của tôi
            </a>

            <a th:if="${session.user.role == 'ADMIN'}" th:href="@{/admin}" class="admin-nav-link">
                <i class="fas fa-cogs"></i> Quản trị
            </a>

            <form th:action="@{/logout}" method="get" style="margin: 0;">
                <button type="submit">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </button>
            </form>
        </div>
    </nav>
</header>

<main>
    <section class="hero-section">
        <div class="hero-content">
            <h1>Vi vu khắp Việt Nam</h1>
            <p>Trải nghiệm hành trình an toàn, tiện lợi và đáng nhớ cùng đường sắt Việt Nam.</p>

            <div class="search-form-container">
                <form class="search-form" action="/search/results" method="get">
                    <div class="input-group">
                        <label for="departure">
                            <i class="fas fa-map-marker-alt"></i> Điểm đi
                        </label>
                        <select id="departure" name="departureStationId" required>
                            <option value="">Chọn điểm đi</option>
                            <option th:each="station : ${stations}"
                                    th:value="${station.stationID}"
                                    th:text="${station.name}"
                                    th:selected="${departureStation != null and departureStation.stationID == station.stationID}">
                            </option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="arrival">
                            <i class="fas fa-map-marker-alt"></i> Điểm đến
                        </label>
                        <select id="arrival" name="arrivalStationId" required>
                            <option value="">Chọn điểm đến</option>
                            <option th:each="station : ${stations}"
                                    th:value="${station.stationID}"
                                    th:text="${station.name}"
                                    th:selected="${arrivalStation != null and arrivalStation.stationID == station.stationID}">
                            </option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="departure-date">
                            <i class="fas fa-calendar-alt"></i> Ngày đi
                        </label>
                        <input type="date"
                               id="departure-date"
                               name="departureDate"
                               th:value="${departureDate}"
                               required>
                    </div>
                    <button type="submit">
                        <i class="fas fa-search"></i> Tìm kiếm
                    </button>
                </form>
            </div>
        </div>
    </section>

    <div class="container" style="margin-top: 30px;">
        <div th:if="${error}" class="alert alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            <span th:text="${error}"></span>
        </div>
        <div th:if="${message}" class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <span th:text="${message}"></span>
        </div>
    </div>

    <section id="search-results" th:if="${schedules != null and not #lists.isEmpty(schedules)}" class="search-results-section container">
        <h2 class="section-title">
            <i class="fas fa-list-ul"></i> Kết quả tìm kiếm
        </h2>
        <p class="section-subtitle" th:if="${departureStation != null and arrivalStation != null}">
            Từ <strong th:text="${departureStation.name}"></strong>
            đến <strong th:text="${arrivalStation.name}"></strong>
            vào ngày <strong th:text="${departureDate}"></strong>
        </p>

        <div class="schedule-list">
            <div th:each="schedule : ${schedules}" class="schedule-item">
                <div class="schedule-header">
                    <h3>
                        <i class="fas fa-train"></i>
                        <span th:text="${schedule.train.trainName}"></span>
                    </h3>
                    <span class="schedule-status"
                          th:classappend="${schedule.status == 'ACTIVE' ? 'status-active' : 'status-inactive'}"
                          th:text="${schedule.status}">
                    </span>
                </div>
                <div class="schedule-route">
                    <div class="route-point">
                        <i class="fas fa-circle" style="color: #28a745;"></i>
                        <div>
                            <p class="station-name" th:text="${schedule.departureStation.name}"></p>
                            <p class="station-time">
                                <i class="fas fa-clock"></i>
                                <span th:text="${#temporals.format(schedule.departureTime, 'HH:mm')}"></span>
                                <span th:text="${#temporals.format(schedule.departureTime, 'dd/MM/yyyy')}"></span>
                            </p>
                        </div>
                    </div>
                    <div class="route-line">
                        <i class="fas fa-arrow-down"></i>
                        <span class="route-duration" th:text="${schedule.estimatedTime} + ' phút'"></span>
                    </div>
                    <div class="route-point">
                        <i class="fas fa-circle" style="color: #dc3545;"></i>
                        <div>
                            <p class="station-name" th:text="${schedule.arrivalStation.name}"></p>
                            <p class="station-time">
                                <i class="fas fa-clock"></i>
                                <span th:text="${#temporals.format(schedule.arrivalTime, 'HH:mm')}"></span>
                                <span th:text="${#temporals.format(schedule.arrivalTime, 'dd/MM/yyyy')}"></span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="schedule-info">
                    <div class="info-item">
                        <i class="fas fa-road"></i>
                        <span>Quãng đường: <strong th:text="${schedule.distanceKm} + ' km'"></strong></span>
                    </div>
                    <div class="info-item price">
                        <i class="fas fa-tag"></i>
                        <span>Giá từ: <strong th:text="${#numbers.formatDecimal(schedule.basePrice, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></strong></span>
                    </div>
                </div>
                <div class="schedule-actions">
                    <a th:href="@{/search/details/{id}(id=${schedule.scheduleID})}" class="btn btn-primary">
                        <i class="fas fa-info-circle"></i> Xem chi tiết
                    </a>

                    <a th:href="@{/booking(scheduleId=${schedule.scheduleID})}" class="btn btn-success">
                        <i class="fas fa-ticket-alt"></i> Đặt vé
                    </a>
                </div>
            </div>
        </div>
    </section>

    <section id="features" class="content-section container">
        <h2 class="section-title">Tại sao chọn EVTrainTicket?</h2>
        <p class="section-subtitle">Chúng tôi mang đến những trải nghiệm tốt nhất cho hành trình của bạn.</p>
        <div class="features-grid">
            <div class="feature-item">
                <div class="icon"><i class="fas fa-ticket-alt"></i></div>
                <h3>Đặt vé nhanh chóng</h3>
                <p>Giao diện thân thiện, quy trình đơn giản chỉ trong vài cú nhấp chuột.</p>
            </div>
            <div class="feature-item">
                <div class="icon"><i class="fas fa-shield-alt"></i></div>
                <h3>Thanh toán an toàn</h3>
                <p>Hỗ trợ nhiều phương thức thanh toán phổ biến và bảo mật tuyệt đối.</p>
            </div>
            <div class="feature-item">
                <div class="icon"><i class="fas fa-headset"></i></div>
                <h3>Hỗ trợ 24/7</h3>
                <p>Đội ngũ chăm sóc khách hàng luôn sẵn sàng giải đáp mọi thắc mắc của bạn.</p>
            </div>
        </div>
    </section>

    <section id="destinations" class="content-section">
        <div class="container">
            <h2 class="section-title">Điểm đến nổi bật</h2>
            <p class="section-subtitle">Khám phá vẻ đẹp đất nước qua những chuyến hành trình.</p>
            <div class="destinations-grid">
                <div class="destination-card">
                    <img th:src="@{/images/danang.jpg}" alt="Hội An">
                    <div class="card-content">
                        <h3>Đà Nẵng - Hội An</h3>
                    </div>
                </div>
                <div class="destination-card">
                    <img th:src="@{/images/nhatrang.jpg}" alt="Nha Trang">
                    <div class="card-content">
                        <h3>Nha Trang</h3>
                    </div>
                </div>
                <div class="destination-card">
                    <img th:src="@{/images/sapa.jpg}" alt="Sa Pa">
                    <div class="card-content">
                        <h3>Sa Pa</h3>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<footer class="site-footer">
    <div class="footer-container container">

        <div class="footer-column">
            <h3><i class="fas fa-train"></i> EVTrainTicket</h3>
            <p>Trải nghiệm hành trình an toàn, tiện lợi và đáng nhớ cùng đường sắt Việt Nam. Đặt vé ngay hôm nay!</p>
        </div>

        <div class="footer-column">
            <h4>Liên kết nhanh</h4>
            <ul>
                <li><a th:href="@{/home}"><i class="fas fa-home"></i> Trang chủ</a></li>
                <li><a th:href="@{/booking/history}"><i class="fas fa-history"></i> Vé của tôi</a></li>
                <li th:if="${session.user != null and session.user.role == 'ADMIN'}">
                    <a th:href="@{/admin}"><i class="fas fa-cogs"></i> Quản trị</a>
                </li>
            </ul>
        </div>

        <div class="footer-column">
            <h4>Liên hệ</h4>
            <ul>
                <li><i class="fas fa-map-marker-alt"></i> Lô E2a-7 - Đường D1 - Khu Công Nghệ Cao - TP. Thủ Đức - TP. HCM</li>
                <li><i class="fas fa-phone"></i> (024) 1234 5678</li>
                <li><i class="fas fa-envelope"></i> support@evtrainticket.vn</li>
            </ul>
        </div>

        <div class="footer-column">
            <h4>Theo dõi chúng tôi</h4>
            <div class="social-links">
                <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" aria-label="Youtube"><i class="fab fa-youtube"></i></a>
            </div>
        </div>
    </div>

    <div class="footer-bottom">
        <p>&copy; 2025 EVTrainTicket. All rights reserved.</p>
    </div>
</footer>

<script th:if="${schedules != null and not #lists.isEmpty(schedules)}">
    document.addEventListener('DOMContentLoaded', function() {
        const resultsSection = document.getElementById('search-results');
        if (resultsSection) {
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });
</script>

</body>
</html>